<head>
    <title>Chat during school!</title>
    <link rel="stylesheet" type="text/css" href="./styles/theme-creator/styles.css">
    <link rel="stylesheet" type="text/css" href="./styles/badges.css">
    <link rel="stylesheet" href="colorjoe/colorjoe.css">
    <script src="colorjoe/colorjoe.min.js"></script>
</head>
<body>
    <div id="grid">
        <iframe src="iframe.html" id="iframe" style="border: unset; height: 100%; width: 100%;"></iframe>
        <div id="theme-creator">
            <div id="colorjoe-container">
                <div id="color-picker"></div>
                <div class="config">
                    <div class="config-title">Selected Color</div>
                    <div class="selected-color-text"></div>
                    <div class="selected-color"></div>
                </div>
            </div><br>
            <div id="color-previews">
                <div>Body Background Color: <span id="body-background-color" original="#f5f5f5">#f5f5f5</span><span>#</span><br></div>
                <div>Message Background Color: <span id="message-color" original="#fffff">#ffffff</span><span>#</span><br></div>
                <div>Button Text Color: <span id="button-color" original="#000000">#000000</span><span>#</span><br></div>
                <div>Button Background Color: <span id="button-background-color" original="#ffffff">#ffffff</span><span>#</span></div>
                <div>Button Text Color Hover: <span id="button-color-hover" original="#ffffff">#ffffff</span><span>#</span></div>
                <div>Button Background Color Hover: <span id="button-background-color-hover" original="#000000">#000000</span><span>#</span></div>
                <div>Text Color: <span id="text-color" original="#000000">#000000</span><span>#</span></div>
                <div>Timestamp Color: <span id="timestamp-color" original="#808080">#808080</span><span>#</span></div>
            </div>
        </div>
    </div>
</body>
<script defer>
    function changeProperty(property, newValue){
        themeTester = document.getElementById("iframe").contentWindow.document;
        let iframeRootElement = themeTester.getElementById("style-root");

        iframeRootElement.appendChild(document.createTextNode(`:root{--${property}: ${newValue};}`))
    }

    let themeTester = document.getElementById("iframe").contentWindow.document;
    
    

    document.body.onload = function() {

        let selectedColor;
        

        class ColorPicker {
            constructor(root) {
                this.root = root;
                this.colorjoe = colorjoe.rgb(document.getElementById("color-picker"));
                this.selectedColor = null;
                this.savedColors = this.getSavedColors();

                this.colorjoe.show();
                this.setSelectedColor("#" + Math.floor(Math.random() * 16777215).toString(16));
                selectedColor = this.selectedColor;

                this.colorjoe.on("change", color => {
                    this.setSelectedColor(color.hex(), true);
                    selectedColor = color.hex();
                });
            }

            setSelectedColor(color, skipCjUpdate = false) {
                this.selectedColor = color;
                this.root.querySelector(".selected-color-text").textContent = color;
                this.root.querySelector(".selected-color").style.background = color;

                if (!skipCjUpdate) {
                    this.colorjoe.set(color);
                }
            }

            getSavedColors() {
                const saved = JSON.parse(localStorage.getItem("colorpicker-saved") || "[]");

                return new Array(5).fill("#ffffff").map((defaultColor, i) => {
                    return saved[i] || defaultColor;
                });
            }
        }

        const cp = new ColorPicker(document.getElementById("colorjoe-container"));

        // get all the spans in the div with the id theme-creator-right-bottom

        function setPreviewColors(){
            let children = [...document.getElementById("color-previews").children];

            for(i = 0; i < children.length; i++){
                let color = children[i].children[0].innerHTML
                let indicator = children[i].children[1]
                
                indicator.style.color = color
                indicator.style.backgroundColor = color

                // console.log(document.documentElement.style.setProperty(`--${children[i].id}`, color))
                changeProperty([...children[i].children][0].id, color)


            }
        }

        setPreviewColors()

        let changeableColors = document.querySelectorAll("#color-previews span[id]");
        [...changeableColors].forEach((div) => {
            div.onclick = () => {
                div.innerHTML = selectedColor
                setPreviewColors()
            }

            // div on context menu
            div.oncontextmenu = e => {
                e.preventDefault();
                div.innerHTML = div.attributes.original.value
                setPreviewColors()
            }
        });
    }
</script>